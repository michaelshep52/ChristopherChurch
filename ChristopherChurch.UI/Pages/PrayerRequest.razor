@page "/PrayerRequest"

<EditForm Model="@prayer" OnValidSubmit="@SubmitPrayerRequest" id="PrayerForm">
    <DataAnnotationsValidator></DataAnnotationsValidator>
    <ValidationSummary></ValidationSummary>

    <label for="name">Full Name:</label>
    <InputText type="text" id="name" @bind-Value="prayer.Name" name="name" required></InputText>

    <label for="email">Your Email:</label>
    <InputText type="email" id="email" @bind-Value="prayer.Email" name="email" required></InputText>

    <label for="prayer">Your Prayer Request:</label>
    <InputTextArea id="prayer" @bind-Value="prayer.Prayer" name="prayer" rows="4" required></InputTextArea>

    <button type="submit" class="btn btn-primary" onclick="SubmitPrayerRequest()">Submit Prayer Request</button>

</EditForm>

@code {
    private PrayerModel prayer = new PrayerModel();

    @inject NavigationManager Navigation

        private async Task SubmitPrayerRequest()
        {
            try
            {
                var message = new MimeKit.MimeMessage();
                message.From.Add(new MimeKit.MailboxAddress("Your Name", "your-email@example.com"));
                message.To.Add(new MimeKit.MailboxAddress("Michael", "michaelshep52@gmail.com"));
                message.Subject = "New Comment";
                message.Body = new MimeKit.TextPart("plain")
                {
                    Text = $"Name: {prayer.Name}\nEmail: {prayer.Email}\nComment: {prayer.Prayer}"
                };

                using (var client = new MailKit.Net.Smtp.SmtpClient())
                {
                    await client.ConnectAsync("smtp.your-email-provider.com", 587, false);
                    await client.AuthenticateAsync("your-email@example.com", "your-email-password");
                    await client.SendAsync(message);
                    await client.DisconnectAsync(true);
                }

                Navigation.NavigateTo("/PrayerRequestSuccess");
            }
            catch (Exception ex)
            {
                Navigation.NavigateTo("/PrayerRequestError");
            }
        }

    }